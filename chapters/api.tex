\chapter{eTilbudsavis API}
For at kunne indhente infomationer om placering af butikker og deres tilbud, anvendes der et API.
Dette API udbydes af eTilbudsavis.dk so er et dansk startup, og er af typen REST.

\section{REST}
REST står for: \textit{Representational state transfer}.
Det er en metode hvorved man opbygger måden som et API. 
Der findes fire metoder som svarer til de fire som findes i CRUD (``CREATE, READ, UPDATE, DELETE'').
Disse metoder er: GET, POST, PUT og Delete.

\textbf{GET}
returnerer data typisk som JSON eller XML og med HTTP svarkoden 200 (OK). 
eTilbudsavis' API sender JSON. 
Svarer til READ i CRUD.

\textbf{POST}
bruges til at oprette nye ressourcer.
Svarer til CREATE i CRUD.

\textbf{PUT}
bruges til at opdatere infomationer, eksmpelvis til at forlænge en session.
Svarer til UPDATE i CRUD.

\textbf{DELETE}
bruges til at fjerne ressourcer. 
Svarer til DELETE i CRUD.

\section{Brug af API}
eTilbudsavis' API er kun et halv-offentligt API, dvs. at man skal have en API-nøgle (``APIKEY'') og dertilhørende hemmelighed (``Secret'').
API'en er placeret på \textit{https://api.etilbudsavis.dk/v2/}. \citep{eTilAPI}

For at kommunikere med API'en fra C\#-kode anvendet værktøjet RestSharp. \citep{RestSharp} 
For at kunne bruge infomationen laves der en klasse, som svarer til det JSON som API'en sender tilbage.

Eksempelvis vil apikaldet som opretter en session returnere:

\begin{lstlisting}[language=json,firstnumber=1,caption="POST til sessions api'en med APIKEYen"]
{
    "token": "00hdcx7fnysn6541",
    "expires": "2013-03-03T13:37:00+0000",
    "user": null,
    "provider": null,
    "permissions": {
        "guest": [
            "api.public",
            "api.users.create"
        ]
    }
}
\end{lstlisting}

For at kunne hente 
%[firstnumber=1,caption="Det foerste API kald"]
\begin{lstlisting}
/* [...] */
/* Create a RestClient*/
var client = new RestClient("https://api.etilbudsavis.dk");

/* Initiate the first request to get a session */
var SessionRequest = new RestRequest("v2/sessions", Method.POST);
SessionRequest.AddParameter("api\_key", GlobalVar.Apikey);

/* Map the response to the class ``Session'' */
IRestResponse<Session> response2 = client.Execute<Session>(SessionRequest);

/* Save the response in an object */
Session sessionobj = response2.Data;
/* [...] */
\end{lstlisting}
